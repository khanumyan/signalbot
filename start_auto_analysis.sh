#!/bin/bash

echo "üöÄ –ó–∞–ø—É—Å–∫ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞ –∫—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç –∫–∞–∂–¥—ã–µ 12 –º–∏–Ω—É—Ç..."
echo "‚è∞ –í—Ä–µ–º—è –∑–∞–ø—É—Å–∫–∞: $(date)"
echo ""

# –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ cron —Ä–∞–±–æ—Ç–∞–µ—Ç
echo "üìÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ cron..."
if crontab -l | grep -q "schedule:run"; then
    echo "‚úÖ Cron –Ω–∞—Å—Ç—Ä–æ–µ–Ω –ø—Ä–∞–≤–∏–ª—å–Ω–æ"
else
    echo "‚ùå Cron –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω! –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º..."
    (crontab -l 2>/dev/null; echo "* * * * * cd /home/ambrian/signal-bot && php artisan schedule:run >> /dev/null 2>&1") | crontab -
    echo "‚úÖ Cron –Ω–∞—Å—Ç—Ä–æ–µ–Ω!"
fi

echo ""
echo "üîÑ –ó–∞–ø—É—Å–∫ –≤ —Ñ–æ–Ω–æ–≤–æ–º —Ä–µ–∂–∏–º–µ..."
echo "üìä –ê–Ω–∞–ª–∏–∑ –±—É–¥–µ—Ç –∑–∞–ø—É—Å–∫–∞—Ç—å—Å—è –∫–∞–∂–¥—ã–µ 12 –º–∏–Ω—É—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏"
echo "üì± –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –±—É–¥—É—Ç –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å—Å—è –≤ Telegram"
echo ""

# –ó–∞–ø—É—Å–∫–∞–µ–º –≤ —Ñ–æ–Ω–æ–≤–æ–º —Ä–µ–∂–∏–º–µ
nohup bash -c '
while true; do
    echo "üîÑ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è –≤ $(date)"
    php artisan schedule:run
    sleep 60
done
' > /dev/null 2>&1 &

echo "‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑ –∑–∞–ø—É—â–µ–Ω –≤ —Ñ–æ–Ω–æ–≤–æ–º —Ä–µ–∂–∏–º–µ!"
echo "üìä PID –ø—Ä–æ—Ü–µ—Å—Å–∞: $!"
echo ""
echo "üîç –î–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ:"
echo "   tail -f storage/logs/crypto_analysis.log"
echo "   ps aux | grep schedule:run"
echo ""
echo "üõë –î–ª—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∏:"
echo "   pkill -f schedule:run"
